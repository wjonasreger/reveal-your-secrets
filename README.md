# Reveal Your Secrets: Secure API Keys with 1Password and OpenAI

*By W. Jonas Reger*

Ever wanted to securely manage your API keys without exposing them, even if your `.env` file gets shared publicly? This project demonstrates how to integrate the [1Password Python SDK](https://developer.1password.com/docs/sdks/python) into your Python applications to safely handle secrets. As a fun example, we'll generate a delightful image of a kitten play-fighting with an older cat using OpenAI's DALL路E 3.

> *"Reveal your secrets..."* - A subtle nod to the magical world where secrets are unveiled responsibly.

## Introduction

Managing sensitive information like API keys in your projects can be challenging, especially when collaborating or pushing code to public repositories. This project introduces a method to reference secrets stored in 1Password directly from your `.env` file using the 1Password SDK. This adds an extra layer of security, ensuring that even if your `.env` file is exposed, your actual secrets remain safe within your 1Password vault.

## Prerequisites

- **Python**: Version 3.7 or higher.
- **1Password Account**: Sign up at [1Password](https://1password.com).
- **1Password CLI**: Install from [here](https://developer.1password.com/docs/cli/get-started#install).
- **OpenAI Account**: Sign up at [OpenAI](https://platform.openai.com/).
- **OpenAI API Key**: Obtain from your OpenAI account dashboard.

## Installation

1. **Clone the Repository**

   ```bash
   git clone https://github.com/wjonasreger/reveal-your-secrets.git
   cd reveal-your-secrets
   ```

2. **Set Up a Virtual Environment**

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # On Windows use `venv\Scripts\activate`
   ```

3. **Install Dependencies**

   ```bash
   pip install -r requirements.txt
   ```

## Setup

### 1. Set Up 1Password Account and CLI

- **Sign Up**: If you don't have an account, [sign up for 1Password](https://1password.com/sign-up/).
- **Install the CLI**: Follow the [installation guide](https://developer.1password.com/docs/cli/get-started#install).
- **Authenticate**: Sign in to the CLI with your 1Password account.

  ```bash
  op signin
  ```

### 2. Store Your Secrets in 1Password

- **Create a Vault**: Organize your secrets by creating a vault, e.g., `OpenAI`.
- **Add Items**: Store your OpenAI credentials as items:

  - **OpenAI-API-Key**
  - **OpenAI-Organization**
  - **OpenAI-Project**

### 3. Configure Environment Variables

- **Create a `.env` File**: In the project root, create a `.env` file containing references to your secrets in 1Password.

  ```env
  OPENAI_API_KEY=op://OpenAI/OpenAI-API-Key
  OPENAI_ORG=op://OpenAI/OpenAI-Organization
  OPENAI_PROJECT=op://OpenAI/OpenAI-Project
  ```

### 4. Set the Service Account Token

- **Generate a Service Account Token**: Follow the [1Password documentation](https://developer.1password.com/docs/cli/service-accounts/) to create a service account and obtain a token.
- **Set the Environment Variable**: Export the token in your shell session.

  ```bash
  export OP_SERVICE_ACCOUNT_TOKEN="your_service_account_token"
  ```

## Usage

Run the main script:

```bash
python main.py
```

This will:

- **Fetch Secrets**: Retrieve your API keys from 1Password.
- **Generate an Image**: Use OpenAI's DALL路E 3 to create an image based on the provided prompt.
- **Save the Image**: The image will be saved as `image.png` in the project directory.

## How It Works

- **Secret Resolver**: The `secret_resolver.py` module uses the 1Password SDK to asynchronously fetch secrets using the paths specified in the `.env` file.
- **Environment Variables**: Instead of storing actual secrets in the `.env` file, we store paths to those secrets in 1Password.
- **Runtime Secret Fetching**: When `main.py` runs, it resolves these paths to actual secrets using the `resolve_secret` function.
- **Security Advantage**: Even if the `.env` file is exposed, your secrets remain protected within 1Password.

## Conclusion

By integrating the 1Password SDK into your Python projects, you enhance the security of sensitive information. This approach ensures that even if your `.env` file is compromised, your actual secrets remain safeguarded in your 1Password vault.

Enjoy the cute kitten play-fighting image generated by DALL路E 3!

![Kitten Play-Fighting](https://raw.githubusercontent.com/wjonasreger/reveal-your-secrets/refs/heads/main/kitty.png)

## References

- [1Password CLI Documentation](https://developer.1password.com/docs/cli/)
- [1Password Python SDK](https://developer.1password.com/docs/sdks/python)
- [OpenAI API Documentation](https://platform.openai.com/docs/introduction)
- [DALL路E 3](https://openai.com/dall-e-3)